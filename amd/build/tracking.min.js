define(["jquery","core/log","local_intellidata/tracking_repository","local_intellidata/cookies_helper"],function(e,n,t,o){var A={AJAXFREQUENCY:30,INACTIVITY:60,PERIOD:1e3,INTERVAL:null,PAGE:"",PARAM:"",MEDIATRACK:0},i={COUNTER:0,AJAXCOUNTER:0,WARNINGTIME:0,LOGOUTTIME:0},a=function(){i.COUNTER=0,i.WARNINGTIME=0,i.LOGOUTTIME=0},E=function(){o.setCookie("intellidatapage",A.PAGE),o.setCookie("intellidataparam",A.PARAM),o.setCookie("intellidatatime",A.AJAXFREQUENCY)},l=function(){A.MEDIATRACK&&(c()&&document.hidden);i.COUNTER<=A.INACTIVITY&&(i.COUNTER++,i.AJAXCOUNTER++,i.AJAXCOUNTER==A.AJAXFREQUENCY&&A.AJAXFREQUENCY&&(t.sendRequest(A.PAGE,A.PARAM),i.AJAXCOUNTER=0))},c=function(){var e=[],n=!1,t=document.querySelectorAll("audio,video"),o=document.querySelectorAll("iframe");return o.length&&o.forEach(function(n){var t=n.contentWindow.document.querySelectorAll("audio,video");t.length&&t.forEach(function(n){e.push(n)})}),t.length&&t.forEach(function(n){e.push(n)}),e.length&&e.forEach(function(e){e.paused||(n=!0)}),n};return{init:function(t){!function(e){A.INACTIVITY=e.inactivity||A.INACTIVITY,A.AJAXFREQUENCY=e.ajaxfrequency||A.AJAXFREQUENCY,A.PERIOD=e.period||A.PERIOD,A.PAGE=e.page||A.PAGE,A.PARAM=e.param||A.PARAM,A.MEDIATRACK=e.mediatrack||A.MEDIATRACK,n.debug("IntelliData: Set Params",[A,i])}(t),e(document).on("mousemove",a),e(document).on("keypress",a),e(document).on("scroll",a),e(window).on("unload",E),setInterval(l,A.PERIOD),n.debug("IntelliData: Start Tracking",[A,i])}}});